import{_ as k}from"./DHnurQmj.js";import{B as b,J as C,r as p,x as U,e as D,f as E,c as f,b as F,a as o,y as v,n as y,z as w,F as R,l as V,d as W,t as m,o as g}from"#entry";import{_ as H}from"./DlAUqK2U.js";import"./DCzUsGh8.js";const x={getUserRecharges:async()=>{const{$supabase:t}=b(),{data:e,error:a}=await t.auth.getUser();if(a||!e?.user)throw new Error("Utilisateur non connecté");const n=e.user.id,{data:h,error:u}=await t.from("recharges").select("*").eq("id_user",n).order("id",{ascending:!1});if(u)throw u;return h||[]},getUserWithdrawls:async()=>{const{$supabase:t}=b(),{data:e,error:a}=await t.auth.getUser();if(a||!e?.user)throw new Error("Utilisateur non connecté");const n=e.user.id,{data:h,error:u}=await t.from("withdrawls").select("*").eq("id_user",n).order("id",{ascending:!1});if(u)throw u;return h||[]}},S={getUserRecharges:async()=>x.getUserRecharges(),getUserWithdrawls:async()=>x.getUserWithdrawls()},L=C("history",()=>{const t=p([]),e=p([]),a=p(!1),n=p(null);return{recharges:t,withdrawls:e,loading:a,error:n,fetchRecharges:async()=>{a.value=!0,n.value=null;try{t.value=await S.getUserRecharges()}catch(i){n.value=i.message||"Erreur lors de la récupération des recharges"}finally{a.value=!1}},fetchWithdrawls:async()=>{a.value=!0,n.value=null;try{e.value=await S.getUserWithdrawls()}catch(i){n.value=i.message||"Erreur lors de la récupération des retraits"}finally{a.value=!1}}}});function M(){const t=L(),e=p(!1),a=p(null),n=async()=>{if(!(t.recharges.length&&t.withdrawls.length)){e.value=!0,a.value=null;try{await Promise.all([t.fetchRecharges(),t.fetchWithdrawls()])}catch(i){a.value=i.message||"Erreur lors du chargement de l’historique"}finally{e.value=!1}}},h=i=>{if(!i)return"";const d=new Date(i),s=String(d.getDate()).padStart(2,"0"),l=String(d.getMonth()+1).padStart(2,"0"),c=d.getFullYear(),_=String(d.getHours()).padStart(2,"0"),r=String(d.getMinutes()).padStart(2,"0");return`${s}/${l}/${c} ${_}:${r}`},u=U(()=>{const i=t.recharges.map(s=>({type:"Recharge",info:s.methode?`Via ${s.methode}`:"Via Mobile Money",date:h(s.created_at||""),amount:s.amount,status:"Réussi"})),d=t.withdrawls.map(s=>({type:"Retrait",info:s.telephone_withdrawls?`Vers ${s.telephone_withdrawls}`:"xxxx",date:h(s.created_at||""),amount:-s.amount,status:s.status}));return[...i,...d].sort((s,l)=>new Date(l.date).getTime()-new Date(s.date).getTime())});return{loading:e,error:a,fetchHistory:n,allOperations:u}}const N={class:"history-container"},O={class:"history-header"},q={class:"filter-options"},A={key:0,class:"history-list"},B={class:"history-content"},I={class:"history-info"},T={class:"history-date"},z={key:1,class:"history-loading"},J={key:2,class:"history-empty"},P={key:3,class:"history-error"},X=D({__name:"history",setup(t){const e=p("all"),{fetchHistory:a,allOperations:n,loading:h,error:u}=M();E(()=>a());const i=U(()=>e.value==="recharge"?n.value.filter(l=>l.type.toLowerCase()==="recharge"):e.value==="retrait"?n.value.filter(l=>l.type.toLowerCase()==="retrait"):n.value),d=l=>e.value=l,s=l=>new Intl.NumberFormat("fr-FR").format(Math.abs(l));return(l,c)=>{const _=k;return g(),f(R,null,[F(_),o("div",N,[o("div",O,[o("div",q,[o("button",{class:y(["filter-btn",{active:e.value==="all"}]),onClick:c[0]||(c[0]=r=>d("all"))},"Tous",2),o("button",{class:y(["filter-btn",{active:e.value==="recharge"}]),onClick:c[1]||(c[1]=r=>d("recharge"))},"Recharges",2),o("button",{class:y(["filter-btn",{active:e.value==="retrait"}]),onClick:c[2]||(c[2]=r=>d("retrait"))},"Retraits",2)])]),!w(h)&&i.value.length?(g(),f("ul",A,[(g(!0),f(R,null,V(i.value,(r,$)=>(g(),f("li",{class:y(["history-item",r.type.toLowerCase()]),key:$},[o("div",B,[o("span",{class:y(["history-type",r.type.toLowerCase()])},m(r.type),3),o("span",I,m(r.info),1),o("span",T,m(r.date),1),r.status?(g(),f("span",{key:0,style:{"margin-left":"5px"},class:y(["history-status",r.status])},m(r.status),3)):v("",!0)]),o("span",{class:y(["history-amount",r.amount>0?"positive":"negative"])},m(r.amount>0?"+":"")+m(s(r.amount))+" XOF ",3)],2))),128))])):v("",!0),w(h)?(g(),f("div",z,[...c[3]||(c[3]=[o("i",{class:"fas fa-spinner fa-spin"},null,-1),W(" Chargement de l'historique... ",-1)])])):i.value.length?v("",!0):(g(),f("div",J,[...c[4]||(c[4]=[o("i",{class:"fas fa-receipt"},null,-1),o("p",null,"Aucune opération pour le moment.",-1),o("small",null,"Vos transactions apparaîtront ici",-1)])])),w(u)?(g(),f("div",P,m(w(u)),1)):v("",!0)])],64)}}}),Q=H(X,[["__scopeId","data-v-e21b8c6b"]]);export{Q as default};

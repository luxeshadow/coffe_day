import{_ as W}from"./D-mM1yGB.js";import{B as p,r as m,e as C,N as f,c as h,a as e,b as U,d,E as V,F as z,l as N,G as _,H as P,I as $,t as w,z as g,w as j,j as B,o as v,n as D}from"#entry";import{_ as L}from"./DlAUqK2U.js";const b={createWallet:async t=>{const{$supabase:r}=p(),{data:{user:i},error:n}=await r.auth.getUser();if(n||!i)throw new Error("Utilisateur non authentifié");const{data:s,error:l}=await r.from("wallets").insert([{id_user:i.id,password:t.password,telephone_withdrawls:t.telephone_withdrawls,methode_withdrawls:t.methode_withdrawls}]).select().single();if(l)throw l;return s},getUserWallets:async()=>{const{$supabase:t}=p(),{data:{user:r},error:i}=await t.auth.getUser();if(i||!r)throw new Error("Utilisateur non authentifié");const{data:n,error:s}=await t.from("wallets").select("*").eq("id_user",r.id).order("id",{ascending:!1});if(s)throw s;return n}},T={createWallet:t=>b.createWallet(t),getUserWallets:()=>b.getUserWallets()},q=t=>{if(!t.telephone_withdrawls||t.telephone_withdrawls.trim().length<8||!/^\d+$/.test(t.telephone_withdrawls))throw new Error("Le numéro de retrait est invalide (minimum 8 chiffres, uniquement des chiffres).");if(!t.password||t.password.trim().length<4)throw new Error("Le mot de passe doit contenir au moins 4 caractères.");if(!t.methode_withdrawls||!["flooz","tmoney"].includes(t.methode_withdrawls))throw new Error("Veuillez sélectionner un moyen de retrait valide (TMoney ou Flooz).");return!0};function A(){const t=m(!1),r=m(null),{$toast:i}=p();return{loading:t,error:r,createWallet:async s=>{t.value=!0,r.value=null;try{q(s);const l=await T.createWallet(s);return i({text:"Portefeuille créé avec succès !",backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)"}),l}catch(l){throw l.message?.includes("duplicate key value")||l?.code==="23505"?r.value="Vous avez déjà un portefeuille.":r.value=l.message||"Erreur inconnue",i({text:"Erreur : "+r.value,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}),l}finally{t.value=!1}}}}const F={class:"wallet-page"},S={class:"wallet-container"},I={class:"wallet-form-group"},R={class:"wallet-payment-options"},G=["onClick"],H=["src","alt"],J={class:"wallet-payment-name"},K={class:"wallet-form-group"},O={class:"wallet-form-group"},Q=["type"],X=["disabled"],Y=C({__name:"create-wallet",setup(t){const r=B(),{createWallet:i,loading:n}=A(),s=f({methode_withdrawls:"",telephone_withdrawls:"",password:""}),l=f({methode_withdrawls:"",telephone_withdrawls:"",password:""}),c=m(!1),y=[{id:"flooz",name:"Moov Money",image:"/img/reseaux/moov.jpg"},{id:"tmoney",name:"T Money",image:"/img/reseaux/mix.jpg"}],x=u=>{s.methode_withdrawls=u,l.methode_withdrawls=""},E=()=>{c.value=!c.value},M=async()=>{try{await i({methode_withdrawls:s.methode_withdrawls,telephone_withdrawls:s.telephone_withdrawls,password:s.password}),s.methode_withdrawls="",s.telephone_withdrawls="",s.password="",r.push("/profile")}catch(u){console.error("Erreur portefeuille :",u)}};return(u,a)=>{const k=W;return v(),h("div",F,[e("div",S,[a[7]||(a[7]=e("div",{class:"wallet-header"},[e("h2",{class:"wallet-title"},[e("i",{class:"fas fa-wallet"}),d(" Mon Portefeuille")]),e("p",{class:"wallet-subtitle"},"Configurez vos informations de retrait")],-1)),e("form",{class:"wallet-form",onSubmit:V(M,["prevent"])},[e("div",I,[a[2]||(a[2]=e("label",{class:"wallet-label"},[e("i",{class:"fas fa-credit-card"}),d(" Moyen de paiement")],-1)),e("div",R,[(v(),h(z,null,N(y,o=>e("div",{key:o.id,class:D(["wallet-payment-option",{active:s.methode_withdrawls===o.id}]),onClick:Z=>x(o.id)},[e("img",{src:o.image,alt:o.name,class:"wallet-img"},null,8,H),e("div",J,w(o.name),1)],10,G)),64))])]),e("div",K,[a[3]||(a[3]=e("label",{for:"numero",class:"wallet-label"},[e("i",{class:"fas fa-phone"}),d(" Numéro de retrait")],-1)),_(e("input",{type:"tel",id:"numero","onUpdate:modelValue":a[0]||(a[0]=o=>s.telephone_withdrawls=o),class:"wallet-input",placeholder:"Ex: +22898765432"},null,512),[[P,s.telephone_withdrawls]])]),e("div",O,[a[4]||(a[4]=e("label",{for:"mdp_retrait",class:"wallet-label"},[e("i",{class:"fas fa-lock"}),d(" Mot de passe de retrait")],-1)),_(e("input",{type:c.value?"text":"password",id:"mdp_retrait","onUpdate:modelValue":a[1]||(a[1]=o=>s.password=o),class:"wallet-input",placeholder:"Mot de passe de retrait"},null,8,Q),[[$,s.password]]),e("button",{type:"button",onClick:E},w(c.value?"Masquer":"Afficher"),1)]),e("button",{type:"submit",class:"wallet-submit-btn",disabled:g(n)},[a[5]||(a[5]=e("i",{class:"fas fa-save"},null,-1)),d(" "+w(g(n)?"Enregistrement...":"Enregistrer"),1)],8,X)],32),U(k,{to:"/profile",class:"recharge-back-link"},{default:j(()=>[...a[6]||(a[6]=[e("i",{class:"fas fa-arrow-left"},null,-1),d("Retour au profil ",-1)])]),_:1})])])}}}),ae=L(Y,[["__scopeId","data-v-3bb4bb13"]]);export{ae as default};

import{B as w,r as f,e as E,j as M,f as L,x as B,c as i,o as a,a as t,y as u,t as v,E as d,F as N,l as x,z as g}from"#entry";import{a as D}from"./DCzUsGh8.js";import{_ as S}from"./DlAUqK2U.js";const C={createNotification:async o=>{const{$supabase:e}=w(),{data:s,error:l}=await e.from("notification").insert([{texte:o.texte,type:o.type||"info"}]).select().single();if(l)throw l;return s},getNotifications:async()=>{const{$supabase:o}=w(),{data:e,error:s}=await o.from("notification").select("*").order("id",{ascending:!1});if(s)throw s;return e}};function A(o){if(!o.texte||o.texte.trim().length===0)throw new Error("Le texte de la notification est obligatoire.");if(o.type&&!["alert","info"].includes(o.type))throw new Error("Le statut de la notification est invalide.")}class O{async createNotification(e){return A(e),C.createNotification(e)}async getNotifications(){return C.getNotifications()}}const V=new O;function j(){const o=f([]),e=f(null),s=f(!1);return{notifications:o,loadNotifications:async()=>{s.value=!0;try{const r=await V.getNotifications();o.value=r}catch(r){console.error("Erreur lors du chargement des notifications :",r),e.value=r.message}finally{s.value=!1}},error:e,loading:s}}const z={class:"app-header"},F={class:"header-right"},H={key:0,class:"notif-badge"},$={key:0,class:"dropdown desktop"},I={key:1,class:"dropdown mobile"},P={class:"dropdown-header"},R={key:0,class:"notif-modal"},q={class:"notif-modal-content"},G={key:0},J=E({__name:"Header",setup(o){const e=f(!1),s=f(!1),l=M(),{notifications:r,loadNotifications:b}=j();L(()=>{b()});const _=B(()=>(r.value??[]).filter(n=>n.type?.toLowerCase()==="info").length),m=()=>{e.value=!e.value},h=()=>{s.value=!s.value},y=async()=>{try{await D.logout(),e.value=!1,l.push("/")}catch(p){console.error("Erreur lors du logout :",p)}},k=()=>{e.value=!1,l.push("/profile")};return(p,n)=>(a(),i("div",z,[n[4]||(n[4]=t("div",{class:"header-left"},[t("i",{style:{"font-size":"32px"},class:"fi fi-rr-coffee"}),t("div",{class:"header-logo"},[t("span",null,"EcoNest")])],-1)),t("div",F,[t("div",{class:"header-icon notif",onClick:h},[n[0]||(n[0]=t("i",{class:"fi fi-rr-bell"},null,-1)),_.value>0?(a(),i("span",H,v(_.value),1)):u("",!0)]),t("div",{class:"header-icon user-menu",onClick:m},[n[2]||(n[2]=t("i",{class:"fi fi-rr-user"},null,-1)),e.value?(a(),i("div",$,[t("ul",null,[t("li",{onClick:d(k,["stop"])},"Mon profil"),t("li",{class:"logout",onClick:d(y,["stop"])},"Déconnexion")])])):u("",!0),e.value?(a(),i("div",I,[t("div",P,[n[1]||(n[1]=t("span",null,"Menu utilisateur",-1)),t("button",{onClick:d(m,["stop"])},"✖")]),t("ul",null,[t("li",{onClick:d(k,["stop"])},"Mon profil"),t("li",{class:"logout",onClick:d(y,["stop"])},"Déconnexion")])])):u("",!0)])]),s.value?(a(),i("div",R,[t("div",q,[t("div",{class:"notif-modal-header"},[n[3]||(n[3]=t("h3",null,"Notifications",-1)),t("button",{onClick:h},"✖")]),t("ul",null,[(a(!0),i(N,null,x(g(r),c=>(a(),i("li",{key:c.id},v(c.type),1))),128)),(a(!0),i(N,null,x(g(r),c=>(a(),i("li",{key:c.id},v(c.texte),1))),128)),g(r).length>0?u("",!0):(a(),i("li",G,"Aucune notification"))])])])):u("",!0)]))}}),U=Object.assign(S(J,[["__scopeId","data-v-7ce15186"]]),{__name:"Header"});export{U as _};

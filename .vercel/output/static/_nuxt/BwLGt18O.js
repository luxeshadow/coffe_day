import{_ as k}from"./D-mM1yGB.js";import{r as u,B as U,j as V,e as S,x as N,f as E,O as B,c as y,a as o,E as M,G as d,H as w,P as q,F as I,l as $,I as C,n as b,z as h,y as j,d as g,b as z,w as F,o as _,t as x}from"#entry";import{r as R}from"./DYCMpitl.js";import{a as T}from"./DCzUsGh8.js";import{_ as A}from"./DlAUqK2U.js";function G(){const c=u(!1),p=u(null),m=u(null),f=V();return{loading:c,error:p,user:m,createUser:async t=>{c.value=!0,p.value=null;const i=U().$toast;try{const n=`${t.countryCode}${t.phone}`,a={user_name:t.user_name.trim(),phone:n,password:t.password,parent_invitecode:t.parent_invitecode?.trim()||""};console.log("Payload envoyé à registerValidate :",JSON.stringify({...a,confirmPassword:t.confirmPassword,countryCode:t.countryCode},null,2)),R({...a,confirmPassword:t.confirmPassword,countryCode:t.countryCode});const v=await T.register(a);return m.value=v,i({text:"Inscription réussie !",backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)"}),f.push("/"),v}catch(n){console.error("Erreur création utilisateur :",n);let a="Erreur inconnue";return n.message?.includes("users_user_name_key")?a="Ce nom d’utilisateur est déjà pris. Veuillez en choisir un autre.":n.message?.includes("users_phone_key")?a="Ce numéro de téléphone est déjà utilisé.":n.message&&(a=n.message),p.value=a,i({text:a,backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}),null}finally{c.value=!1}}}}const J={class:"register-wrapper"},L={class:"register-container"},O={class:"form-group"},H={class:"form-group"},K={class:"phone-input"},Q=["value"],W={class:"phone-wrapper"},X=["src"],Y={class:"form-group password-group"},Z={class:"password-wrapper"},D=["type"],ee={class:"form-group password-group"},oe={class:"password-wrapper"},se=["type"],re={class:"form-group"},te=["disabled"],ne={key:0,class:"fas fa-spinner fa-spin mr-2"},ae={class:"register-link"},ie=S({__name:"register",setup(c){const p=B(),{createUser:m,loading:f}=G(),s=u({user_name:"",phone:"",countryCode:"+228",password:"",confirmPassword:"",invitationCode:""}),t=u(!1),i=u(!1),n=[{code:"TG",dial_code:"+228",flag:"/img/pays/togo.png"},{code:"BF",dial_code:"+226",flag:"/img/pays/burkina.png"},{code:"BN",dial_code:"+229",flag:"/img/pays/benin.png"},{code:"SN",dial_code:"+221",flag:"/img/pays/senegal.png"}],a=N(()=>n.find(l=>l.dial_code===s.value.countryCode)||n[0]);E(()=>{const l=p.query.ref;l&&(s.value.invitationCode=l.toString())});const v=async()=>{const l={user_name:s.value.user_name,phone:s.value.phone,countryCode:s.value.countryCode,password:s.value.password,confirmPassword:s.value.confirmPassword,parent_invitecode:s.value.invitationCode||null};try{await m(l)}catch(e){console.error("Erreur lors de la création:",e)}};return(l,e)=>{const P=k;return _(),y("div",J,[o("div",L,[e[17]||(e[17]=o("h1",null,"Sign up",-1)),e[18]||(e[18]=o("p",null,"Join our community and contribute to a greener future through smart recycling!",-1)),o("form",{onSubmit:M(v,["prevent"]),id:"signup-form"},[o("div",O,[e[8]||(e[8]=o("label",{for:"user-name"},"Username*",-1)),d(o("input",{type:"text",id:"user-name","onUpdate:modelValue":e[0]||(e[0]=r=>s.value.user_name=r),placeholder:"johndoe123",required:""},null,512),[[w,s.value.user_name]])]),o("div",H,[e[9]||(e[9]=o("label",{for:"phone"},"Enter your phone number*",-1)),o("div",K,[d(o("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>s.value.countryCode=r),class:"country-select"},[(_(),y(I,null,$(n,r=>o("option",{key:r.code,value:r.dial_code},x(r.dial_code)+" ("+x(r.code)+") ",9,Q)),64))],512),[[q,s.value.countryCode]]),o("div",W,[o("img",{src:a.value.flag,class:"flag-inside-input",alt:"Selected country flag"},null,8,X),d(o("input",{type:"tel",id:"phone","onUpdate:modelValue":e[2]||(e[2]=r=>s.value.phone=r),placeholder:"e.g. 90123456",required:""},null,512),[[w,s.value.phone]])])])]),o("div",Y,[e[10]||(e[10]=o("label",{for:"password"},"Enter your password*",-1)),o("div",Z,[d(o("input",{type:t.value?"text":"password",id:"password","onUpdate:modelValue":e[3]||(e[3]=r=>s.value.password=r),placeholder:"Minimum 8 characters",required:""},null,8,D),[[C,s.value.password]]),o("i",{class:b([t.value?"fi fi-rr-eye":"fi fi-rr-eye-crossed","toggle-password"]),onClick:e[4]||(e[4]=r=>t.value=!t.value)},null,2)])]),o("div",ee,[e[11]||(e[11]=o("label",{for:"confirm-password"},"Confirm your password*",-1)),o("div",oe,[d(o("input",{type:i.value?"text":"password",id:"confirm-password","onUpdate:modelValue":e[5]||(e[5]=r=>s.value.confirmPassword=r),placeholder:"Re-enter your password",required:""},null,8,se),[[C,s.value.confirmPassword]]),o("i",{class:b([i.value?"fi fi-rr-eye":"fi fi-rr-eye-crossed","toggle-password"]),onClick:e[6]||(e[6]=r=>i.value=!i.value)},null,2)])]),o("div",re,[e[12]||(e[12]=o("label",{for:"invitation-code"},"Invitation code",-1)),d(o("input",{type:"text",id:"invitation-code","onUpdate:modelValue":e[7]||(e[7]=r=>s.value.invitationCode=r),readonly:"",placeholder:"Auto-generated"},null,512),[[w,s.value.invitationCode]])]),o("button",{type:"submit",disabled:h(f)},[h(f)?(_(),y("i",ne)):j("",!0),e[13]||(e[13]=g(" Sign up ",-1))],8,te)],32),o("p",ae,[e[15]||(e[15]=g(" If you already have an account, ",-1)),z(P,{to:"/"},{default:F(()=>[...e[14]||(e[14]=[g("log in",-1)])]),_:1}),e[16]||(e[16]=g(". ",-1))])])])}}}),me=A(ie,[["__scopeId","data-v-ae8713d2"]]);export{me as default};

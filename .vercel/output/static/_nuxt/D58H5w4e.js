import{_ as R}from"./D-mM1yGB.js";import{_ as G}from"./Dr1xzAX7.js";import{B as m,J as N,e as D,C as A,v as M,D as $,x as w,f as B,c as d,a as e,b as f,t as n,z as l,d as C,w as v,F as k,l as E,o as u}from"#entry";import{_ as z}from"./DlAUqK2U.js";const g={getMyInviteCode:async()=>{const{$supabase:s}=m(),{data:{user:a},error:o}=await s.auth.getUser();if(o||!a)throw new Error("Utilisateur non authentifié");const{data:t,error:i}=await s.from("users").select("invitecode").eq("auth_id",a.id).single();if(i)throw i;return t?.invitecode||null},getReferralLink:async()=>{const s=await g.getMyInviteCode();return s?`${window.location.origin}/register?ref=${s}`:null},getMyReferrals:async()=>{const{$supabase:s}=m(),a=await g.getMyInviteCode();if(!a)throw new Error("Aucun code de parrainage trouvé pour cet utilisateur");const{data:o,error:t}=await s.from("users").select("id, user_name, phone, parent_invitecode").eq("parent_invitecode",a);if(t)throw t;return o||[]}},F=N("referralStore",{state:()=>({inviteCode:null,referralLink:null,referrals:[],loading:!1,error:null}),actions:{async loadReferralData(){this.loading=!0,this.error=null;try{const s=localStorage.getItem("referralData");if(s){const t=JSON.parse(s);this.inviteCode=t.inviteCode||null,this.referralLink=t.referralLink||null,this.referrals=t.referrals||[]}const a=await g.getMyInviteCode();this.inviteCode=a||null,this.referralLink=a?`${window.location.origin}/register?ref=${a}`:null;const o=await g.getMyReferrals()||[];this.referrals=Array.isArray(o)?o:[],localStorage.setItem("referralData",JSON.stringify({inviteCode:this.inviteCode,referralLink:this.referralLink,referrals:this.referrals}))}catch(s){console.error("Erreur parrainage:",s),this.error=s.message||"Erreur chargement données de parrainage",this.referrals=[]}finally{this.loading=!1}},clearReferralData(){this.inviteCode=null,this.referralLink=null,this.referrals=[],localStorage.removeItem("referralData")}},getters:{referralCount:s=>s.referrals.length,hasReferrals:s=>s.referrals.length>0}}),U={class:"profil-header"},V={class:"profil-phone-number"},q={class:"profil-grade"},J={class:"profil-container"},O={class:"profil-balance-card"},H={class:"profil-balance-amount"},P={class:"profil-stats-row"},T={class:"profil-stat-item"},X={class:"profil-stat-value"},j={class:"profil-stat-item"},K={class:"profil-stat-value"},Q={class:"profil-earnings-section"},W={class:"profil-earning-card"},Y={class:"profil-earning-amount"},Z={class:"profil-earning-card"},ee={class:"profil-earning-amount weekly"},re={class:"profil-actions-section"},se={class:"profil-action-grid"},te={class:"referral-section"},ie={class:"referral-card"},ae={class:"referral-link-container"},oe={class:"referral-input-group"},le=["value"],ne=["disabled"],ce={class:"referral-benefits"},de={style:{"margin-bottom":"10px"},class:"benefit-item"},fe={key:0,class:"referral-users-box"},ue={class:"referral-users-list"},pe={class:"referral-user-info"},ve={class:"user-name"},ge={class:"user-phone"},me={key:1,class:"no-referral-users"},_e=D({__name:"profile",setup(s){const a=A(),o=M(),t=$(),i=F(),{$toast:_}=m(),I=w(()=>a.phone),x=w(()=>t.dailyIncome*7),c=y=>{const r=Math.floor(y);return new Intl.NumberFormat("fr-FR",{style:"decimal"}).format(r)+" XOF"},h=async()=>{if(i.referralLink)try{await navigator.clipboard.writeText(i.referralLink),_({text:"Lien de parrainage copié avec succès !",backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)"})}catch{_({text:"Impossible de copier le lien.",backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"})}};return B(async()=>{await o.fetchUserGains(),await t.fetchUserDailyIncome(),await i.loadReferralData()}),(y,r)=>{const p=R,S=G;return u(),d(k,null,[e("div",U,[e("div",V,n(I.value),1),e("div",q,n(l(t).topGradeName??"Collect 0"),1)]),e("div",J,[r[17]||(r[17]=e("div",{class:"profil-info-section"},[e("div",{class:"profil-info-icon"},"i"),e("div",{class:"profil-info-text"}," Gérez facilement votre compte pour suivre vos investissements, consulter vos gains et personnaliser vos paramètres en toute sécurité. ")],-1)),e("div",O,[e("div",H,n(c(l(o).walletBalance)),1),r[2]||(r[2]=e("div",{class:"profil-balance-label"},"Solde disponible",-1)),e("div",P,[e("div",T,[e("div",X,n(c(l(o).totalRecharges)),1),r[0]||(r[0]=e("div",{class:"profil-stat-label"},"Investis",-1))]),e("div",j,[e("div",K,n(c(l(o).totalGradeGains)),1),r[1]||(r[1]=e("div",{class:"profil-stat-label"},"Gains",-1))])])]),e("div",Q,[e("div",W,[r[3]||(r[3]=e("div",{class:"profil-earning-title"},"Gains Journaliers",-1)),e("div",Y,n(c(l(t).dailyIncome)),1)]),e("div",Z,[r[4]||(r[4]=e("div",{class:"profil-earning-title"},"Gains Hebdomadaires",-1)),e("div",ee,n(c(x.value)),1)])]),e("div",re,[r[9]||(r[9]=e("h2",{class:"profil-section-title"},[e("i",{class:"fi fi-rr-bolt"}),C(" Actions Rapides ")],-1)),e("div",se,[f(p,{to:"/recharge"},{default:v(()=>[...r[5]||(r[5]=[e("div",{class:"profil-action-card"},[e("div",{class:"profil-action-icon"},[e("i",{class:"fi fi-rr-rotate-right"})]),e("div",{class:"profil-action-title"},"Recharge")],-1)])]),_:1}),f(p,{to:"/retrait"},{default:v(()=>[...r[6]||(r[6]=[e("div",{class:"profil-action-card"},[e("div",{class:"profil-action-icon"},[e("i",{class:"fi fi-rr-chart-mixed-up-circle-dollar"})]),e("div",{class:"profil-action-title"},"Retrait")],-1)])]),_:1}),f(p,{to:"/create-wallet"},{default:v(()=>[...r[7]||(r[7]=[e("div",{class:"profil-action-card"},[e("div",{class:"profil-action-icon"},[e("i",{class:"fi fi-rr-coins"})]),e("div",{class:"profil-action-title"},"Portefeuille")],-1)])]),_:1}),f(p,{to:"/history"},{default:v(()=>[...r[8]||(r[8]=[e("div",{class:"profil-action-card"},[e("div",{class:"profil-action-icon"},[e("i",{class:"fi fi-rr-rectangle-history-circle-plus"})]),e("div",{class:"profil-action-title"},"Historique")],-1)])]),_:1})])]),e("div",te,[e("div",ie,[r[15]||(r[15]=e("div",{class:"referral-header"},[e("i",{class:"fi fi-rr-gift"}),e("h3",null,"Votre lien de parrainage")],-1)),r[16]||(r[16]=e("p",{class:"referral-description"}," Partagez votre lien avec vos amis et gagnez des récompenses pour chaque inscription validée. ",-1)),e("div",ae,[r[11]||(r[11]=e("label",{class:"referral-label",for:"referralInput"},"Lien à partager :",-1)),e("div",oe,[e("input",{id:"referralInput",class:"referral-input",type:"text",value:l(i).loading?"Chargement...":l(i).referralLink,readonly:"",onClick:h},null,8,le),e("button",{class:"copy-button",onClick:h,disabled:l(i).loading},[...r[10]||(r[10]=[e("i",{class:"fi fi-rr-copy"},null,-1)])],8,ne)])]),e("div",ce,[e("div",de,[r[12]||(r[12]=e("i",{class:"fi fi-rr-plus"},null,-1)),C(" Vous avez parrainé "+n(l(i).referralCount),1)])]),l(i).referrals.length?(u(),d("div",fe,[r[13]||(r[13]=e("h4",{class:"referral-users-title"},"Utilisateurs parrainés",-1)),e("ul",ue,[(u(!0),d(k,null,E(l(i).referrals,(b,L)=>(u(),d("li",{key:L,class:"referral-user-item"},[e("div",pe,[e("span",ve,n(b.user_name),1),e("span",ge,n(b.phone),1)])]))),128))])])):(u(),d("div",me,[...r[14]||(r[14]=[e("p",null,"Aucun utilisateur parrainé pour le moment.",-1)])]))])])]),f(S)],64)}}}),Ce=z(_e,[["__scopeId","data-v-65f57283"]]);export{Ce as default};

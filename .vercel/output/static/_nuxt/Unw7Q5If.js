import{_ as h}from"./DHnurQmj.js";import{_ as k}from"./D-mM1yGB.js";import{B as w,K as x,e as G,D as C,r as b,c as l,o as r,a as s,y as E,F as p,l as A,L as N,t as _,z as y,w as $,d as v,E as B,b as f}from"#entry";import{_ as S}from"./DlAUqK2U.js";import{_ as I}from"./Dr1xzAX7.js";import"./DCzUsGh8.js";function F(){return{assignGrade:async i=>{const{$supabase:c,$toast:o}=w();try{const{walletBalance:e}=await x.getUserGains();if(e<(i.amounts??0))return o({text:"Solde insuffisant pour ce grade",backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}),!1;const{data:{user:d},error:m}=await c.auth.getUser();if(m||!d)throw new Error("Utilisateur non authentifié");const n=d.id,{error:t}=await c.from("assigne_user_grade").insert([{id_user:n,id_grade:i.id}]);if(t)throw t;const{error:u}=await c.from("withdrawls").insert([{id_user:n,amount:i.amounts,status:"Achat de boite"}]);if(u)throw u;return o({text:`Grade ${i.grade_name} acheté avec succès !`,backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)"}),!0}catch(e){return console.error("Erreur assignation grade :",e),o({text:"Erreur : "+(e.message||"Erreur inconnue"),backgroundColor:"linear-gradient(to right, #ff5f6d, #ffc371)"}),!1}}}}const L={class:"investment-grid"},V={class:"card-image"},z=["src","alt"],O={class:"card-content"},U={class:"invest-title"},q={class:"invest-details"},D={class:"invest-amount"},M={class:"invest-value"},X={class:"invest-revenue"},j={class:"revenue-value"},H={key:0,class:"fas fa-spinner fa-spin mr-2"},K={key:1,style:{"margin-top":"4px"},class:"fi fi-rr-play-circle"},R={key:1,class:"activated-badge"},T={key:0,class:"modal-overlay"},J={class:"modal-content"},P={class:"modal-actions"},Q=G({__name:"InvestmentGrid",setup(g){const i=C(),{assignGrade:c}=F(),o=b(new Set),e=b(null),d=n=>{e.value=n},m=async n=>{if(e.value=null,!o.value.has(n.id)){o.value.add(n.id);try{await c(n),i.userGrades.push(n)}finally{o.value.delete(n.id)}}};return(n,t)=>{const u=k;return r(),l(p,null,[t[9]||(t[9]=s("div",{class:"info-sections"},[s("div",{class:"info-icon"},"i"),s("div",{class:"info-text"}," Investissez dans les initiatives écologiques NESCAFÉ et générez des revenus tout en soutenant le recyclage des gobelets. ")],-1)),s("div",L,[(r(!0),l(p,null,A(y(i).grades,a=>(r(),l("div",{key:a.id,class:"invest-card"},[s("div",V,[s("img",{src:a.img??"/img/coffee/boite2.png",alt:a.grade_name},null,8,z)]),s("div",O,[s("div",U,"Boite "+_(a.grade_name),1),s("div",q,[s("div",D,[t[2]||(t[2]=s("span",{class:"invest-label"},"Investissement:",-1)),s("span",M,_(a.amounts?.toLocaleString())+" XOF",1)]),s("div",X,[t[3]||(t[3]=s("span",{class:"invest-label"},"Revenus quotidiens:",-1)),s("span",j,_(a.daily_income?.toLocaleString())+" XOF",1)])]),y(i).isGradeActivated(a.id)?(r(),l("div",R,[...t[5]||(t[5]=[s("i",{style:{"margin-top":"2px"},class:"fi fi-rr-badget-check-alt"},null,-1),v(" Actif... ",-1)])])):(r(),N(u,{key:0,to:"#",class:"debut-button",onClick:B(Y=>d(a),["prevent"])},{default:$(()=>[o.value.has(a.id)?(r(),l("i",H)):(r(),l("i",K)),t[4]||(t[4]=v(" Activé ",-1))]),_:2},1032,["onClick"]))])]))),128))]),e.value?(r(),l("div",T,[s("div",J,[t[8]||(t[8]=s("h3",null,"Confirmer l'activation",-1)),s("p",null,[t[6]||(t[6]=v("Voulez-vous vraiment activer la boite ",-1)),s("strong",null,_(e.value.grade_name),1),t[7]||(t[7]=v(" ?",-1))]),s("div",P,[s("button",{class:"btn-cancel",onClick:t[0]||(t[0]=a=>e.value=null)},"Non"),s("button",{class:"btn-confirm",onClick:t[1]||(t[1]=a=>m(e.value))},"Oui")])])])):E("",!0)],64)}}}),W=Object.assign(S(Q,[["__scopeId","data-v-55ba5b52"]]),{__name:"InvestmentGrid"}),ot={__name:"activity",setup(g){return(i,c)=>{const o=h,e=W,d=I;return r(),l(p,null,[f(o),f(e),f(d)],64)}}};export{ot as default};
